<script>
const webhookURL = "PASTE_YOUR_WEBHOOK_HERE";

function calculatePrice() {
    const tierPrice = parseFloat(document.getElementById("item").value);
    const quantity = parseFloat(document.getElementById("quantity").value);
    const x = parseFloat(document.getElementById("xcoord").value);
    const z = parseFloat(document.getElementById("zcoord").value);

    if (!tierPrice || !quantity || isNaN(x) || isNaN(z)) return 0;

    let baseCost = tierPrice * quantity;

    // Bulk scaling
    if (quantity > 64) baseCost *= 1.2;
    else if (quantity > 32) baseCost *= 1.1;
    else if (quantity > 16) baseCost *= 1.05;

    // Distance scaling
    const distance = Math.sqrt((x*x) + (z*z));
    let distanceMultiplier = 1;

    if (distance > 6000) distanceMultiplier = 1.5;
    else if (distance > 3000) distanceMultiplier = 1.25;
    else if (distance > 1000) distanceMultiplier = 1.1;

    const totalCost = Math.round(baseCost * distanceMultiplier);

    document.getElementById("priceDisplay").innerText =
        "Total Cost: " + totalCost + " Diamonds";

    return totalCost;
}

function isSuspicious(x, z, quantity, tierPrice, notes) {
    if (quantity <= 0) return true;
    if (Math.abs(x) > 30000 || Math.abs(z) > 30000) return true;
    if (quantity > 256) return true;
    if (tierPrice == 20 && quantity > 10) return true;

    // Basic note filter (anti spam / weird stuff)
    const bannedWords = ["hack", "free", "admin abuse"];
    for (let word of bannedWords) {
        if (notes.toLowerCase().includes(word)) {
            return true;
        }
    }

    return false;
}

// Auto price update
document.querySelectorAll("input, select, textarea").forEach(element => {
    element.addEventListener("input", calculatePrice);
});

document.getElementById("shopForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const username = document.getElementById("username").value;
    const x = parseFloat(document.getElementById("xcoord").value);
    const z = parseFloat(document.getElementById("zcoord").value);
    const itemName = document.getElementById("item").selectedOptions[0].text;
    const tierPrice = parseFloat(document.getElementById("item").value);
    const quantity = parseFloat(document.getElementById("quantity").value);
    const notes = document.getElementById("notes").value || "None";

    const totalCost = calculatePrice();
    const flagged = isSuspicious(x, z, quantity, tierPrice, notes);

    const message = {
        content: `${flagged ? "ğŸš¨ **FLAGGED ORDER** ğŸš¨" : "ğŸ›’ **New Order**"}
        
ğŸ‘¤ Username: ${username}
ğŸ“ Location: ${x}, ${z}
ğŸ“¦ Item: ${itemName}
ğŸ”¢ Quantity: ${quantity}
ğŸ’ Total Cost: ${totalCost} Diamonds
ğŸ“ Notes: ${notes}`
    };

    fetch(webhookURL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(message)
    });

    alert(flagged ? 
        "Order submitted but flagged for review." :
        "Order Submitted Successfully!"
    );

    document.getElementById("shopForm").reset();
    document.getElementById("priceDisplay").innerText =
        "Total Cost: 0 Diamonds";
});
</script>
